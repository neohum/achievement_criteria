# 성취기준 카드 분류 및 정렬 서비스 계획서

## 1. 개요
본 서비스는 초등학교 3~4학년군, 5~6학년군 성취기준 데이터를 기반으로 사용자가 원하는 학년군과 과목을 선택하여 해당하는 성취기준 카드를 조회하고, 이를 시각적으로 배치 및 메모를 추가하여 엑셀(Excel)로 다운로드할 수 있는 웹 어플리케이션입니다.

## 2. 주요 기능 및 요구사항 (요약)
1. **데이터 연동 및 파싱**: 주어진 구글 스프레드시트 링크 또는 CSV 데이터를 파싱하여 3~4학년군, 5~6학년군 성취기준 데이터를 추출합니다.
2. **필터링 시스템**: `학년군`과 `과목(교과)`를 선택할 수 있는 드롭다운 메뉴 및 필터를 제공합니다.
3. **카드 리스트 (사이드바)**: 선택된 조건에 맞는 성취기준들이 오른쪽 사이드바에 카드 형태로 목록화되어 나타납니다.
4. **드래그 앤 드롭 (메인 영역)**: 오른쪽 사이드바의 카드를 중앙 메인 영역으로 드래그 앤 드롭하여 배치하고, 순서를 자유롭게 정렬할 수 있습니다.
5. **메모 기능**: 메인 영역에 배치된 각각의 성취기준 카드에 사용자가 텍스트 메모를 작성할 수 있는 기능을 제공합니다.
6. **작업 이력 자동 저장 (데이터베이스 연동)**: 드래그 등으로 카드를 이동하거나 메모를 작성할 때마다 상태를 실시간(Autosave)으로 데이터베이스에 저장하여, 나중에 접속해도 기존 작업 이력을 불러올 수 있습니다.
7. **다중 보드(작업 목록) 관리**: 여러 개의 개별 작업(보드)을 생성하고, 이름으로 관리하며 리스트 형태로 조회하여 이동할 수 있습니다.
8. **실시간 다중 접속 협업**: 생성된 보드 주소에 여러 명이 동시 접속 시 편집 상태와 이동 내역이 서로의 화면에 실시간으로 시각화되어 반영됩니다. (Server-Sent Events 및 Redis Pub/Sub 활용)
9. **엑셀 다운로드 (내보내기)**: 정렬된 카드의 순서와 입력된 메모를 취합하여 엑셀(.xlsx) 형태의 파일로 다운로드할 수 있도록 합니다.

## 3. 기술 스택 제안
- **Frontend Framework**: Next.js (App Router 활용)
- **Styling**: Vanilla CSS (현대적인 UI/UX, Glassmorphism 등 적용)
- **Database**: `PostgreSQL` (ORM으로 **Prisma** 활용)
- **In-memory Data Store**: `Redis` (실시간 변경 상태 임시 저장 및 빠른 쓰기/읽기)
- **Drag and Drop**: `@hello-pangea/dnd` 또는 `dnd-kit` 라이브러리 활용
- **Data Parsing**: `papaparse` (CSV 파싱 라이브러리)
- **Excel Export**: `xlsx` (SheetJS) 라이브러리 활용

## 4. 화면 구성 디자인 (UI/UX)
- **Top Bar (상단바)**: 
  - 서비스 로고 / 제목
  - 엑셀 다운로드 버튼
- **Left/Center Main Area (메인 보드 영역)**: 
  - 드래그 앤 드롭으로 카드를 배치하는 공간
  - 배치된 카드는 상하(또는 좌우) 리스트 형태로 정렬
  - 각 카드 내부에는 내용(성취기준 등)과 하단에 `메모 입력 칸` 위치
  - 상단 모서리에 `자동 저장 중... / 저장 완료` 상태 표시 인디케이터
- **Right Sidebar (오른쪽 패널)**:
  - 상단: `학년군` 선택 (3~4, 5~6), `과목` 선택 (국어, 수학 등) 드롭다운
  - 하단: 조건에 맞는 성취기준 카드 목록 (드래그 가능한 형태)

## 5. 단계별 구현 계획 (Task Breakdown)

### Phase 1: 프로젝트 세팅 및 기본 UI 프레임워크 구축
- [ ] `npx create-next-app@latest` 를 활용하여 Next.js 프로젝트 생성
- [ ] 글로벌 CSS 설정 (테마, 폰트, 기본 색상 지정)
- [ ] 메인 레이아웃 분할 (Top NavBar, Main Board, Right Sidebar)

### Phase 2: 데이터 처리 및 사이드바 구현
- [ ] 구글 스프레드시트 CSV 데이터 다운로드 및 로컬 에셋(또는 동적 fetch)으로 추가
- [ ] `papaparse`를 활용하여 CSV 데이터를 JSON 형태로 파싱
- [ ] 3~4학년군, 5~6학년군 데이터 필터링 로직 구현
- [ ] 오른쪽 사이드바에 필터(학년군, 과목) UI 구현 및 카드 렌더링

### Phase 3: 드래그 앤 드롭(Drag & Drop) 구현
- [ ] `dnd-kit` 또는 `@hello-pangea/dnd` 라이브러리 설치 및 세팅
- [ ] 오른쪽 사이드바 ↔ 메인 영역 간의 드래그 이동 로직 구현
- [ ] 메인 영역 내에서의 카드 순서 변경(Sortable) 기능 구현

### Phase 4: 데이터베이스 연동 및 자동 저장 (Autosave) 기능
- [ ] PostgreSQL 데이터베이스 및 Redis(예: Upstash 등) 환경 세팅
- [ ] **Prisma ORM**을 활용한 스키마 설계 및 마이그레이션 (Session, BoardState 등)
- [ ] Next.js API Routes (또는 Server Actions) 연동
- [ ] **실시간 저장 전략 (Redis + Postgres)**:
  - 카드 조작(이동, 메모) 시, 프론트엔드에서 즉시 API 호출
  - 백엔드에서 **가볍고 빠른 연산인 Redis에 실시간(Real-time)으로 최신 상태 업데이트**
  - 주기적인 스케쥴링(Cron 또는 Background Job) 구성을 통해 Redis의 최신 데이터를 **메인 DB(PostgreSQL)로 동기화(Sync)**하여 영구 보존
- [ ] 접속 시 우선 Redis에서 최신 이력 데이터를 로드하고 실패 시 DB에서 폴백(Fallback)하는 로직 구현

### Phase 5: 메모 및 엑셀 다운로드 기능
- [ ] 메인 영역의 각 카드 컴포넌트에 메모(Textarea) 추가 및 상태 관리 (Redis 연동)
- [ ] `xlsx` 라이브러리를 사용하여 나열된 데이터(순서, 성취기준 정보, 작성 메세지)를 엑셀 파일로 변환하는 로직 구현
- [ ] 상단바의 엑셀 다운로드 버튼과 연동

### Phase 6: 스타일링 및 디자인 고도화 (Polish)
- [x] 사용자가 만족할 만한 유려한 인터페이스 디자인 적용 (색상, 그림자, Hover 등 애니메이션 디테일)
- [x] 자동 저장 상태 (저장 중, 완료 등)에 대한 UI/UX 구현 (Toast 메시지 등)
- [x] 전역 상태 관리 로직 최적화 
- [x] 최종 테스트 (기능 정상 작동 및 반응형 여부 확인)

### Phase 8: 다중 보드 관리 및 실시간 협업 고도화 (New)
- **다중 보드(작업 공간) 관리**
  - Prisma Database 스키마에 `Board` 엔티티(명칭, 생성일, 데이터) 추가
  - 최초 진입 시 내 '작업 리스트'를 볼 수 있는 랜딩 또는 사이드 메뉴 UI 구현
  - 새 보드 생성 및 이름 수정 기능 개발
- **실시간 통신 파이프라인 (SSE + Redis Pub/Sub)**
  - Next.js Route Handlers에서 `Server-Sent Events(SSE)` 엔드포인트를 구현하여 클라이언트와 지속적인 연결 수립.
  - 사용자가 카드를 드래그하거나 메모를 수정할 때마다 저장 API가 `Redis Pub/Sub`로 메시지 발행(Publish).
  - SSE 서버에서 구독(Subscribe)중인 채널의 변경사항을 실시간으로 클라이언트 브라우저로 푸시하여 즉시 반영.
- **시각적 협업 피드백**
  - 현재 보드에 접속해 있는 실시간 인원 표시
  - 타인이 카드 순서를 변경하거나 수정 중일 때 시각적인 표시(예: 테두리 하이라이트 혹은 알림 토스트)

### Phase 9: 모바일 지원 및 반응형(Responsive) 웹 고도화
- [x] 모바일 해상도(320px ~ 768px 이하) 접속 시 화면 최적화
- [x] 메인 영역과 사이드바를 세로 분할(`flex-col`)하여 상단/하단 영역에서 패널 스크롤링 및 드래그가 무리 없이 되도록 뷰포트 배분
- [x] 상단바 및 로비 페이지 글꼴 축소, 마진 패딩 반응형 클래스(`md:`) 적용

### Phase 10: 성취기준 데이터 PostgreSQL 전환 (구글 스프레드시트 의존성 제거)
- **목적**: 구글 스프레드시트 연동으로 인한 의존성 및 로딩 속도 지연 문제를 해결하기 위함입니다.
- **방향**: 기존 Google Sheets CSV를 매번 파싱(`fetchData.ts`)하던 방식에서, PostgreSQL 내부 엔티티(`AchievementCriteria`)로 데이터를 전부 마이그레이션 후 직접 조회하는 최적화 로직으로 변경.
- **구현 단계**:
  1. `schema.prisma`에 성취기준 스키마(`AchievementCriteria`) 작성.
  2. 한 번만 구글 시트 데이터를 전부 긁어와 PostgreSQL에 밀어넣는 시드(Seed) 전용 API 라우트 작성 (또는 Seed 스크립트 작성).
  3. 데이터 적재가 완료되면, `src/utils/fetchData.ts`를 전면 수정하여 `prisma.achievementCriteria.findMany()`를 리턴하도록 교체.

## 6. 승인 요청 (User Review Required)
- 구글 스프레드시트 데이터를 완전히 제거하고 내부 DB(PostgreSQL)에 성취기준을 저장하고 조회하도록 구조를 변경하려 합니다. 진행할까요?
